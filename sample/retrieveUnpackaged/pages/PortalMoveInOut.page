<apex:page sidebar="false" showHeader="true"
    tabstyle="PortalAccounts__tab" action="{!CheckRedirectConfirmed}"
    controller="PortalMoveInOut_Controller" id="thePage">
    
    <!-- 
    Type:       VF page
    Purpose:    Move In and Out
    ---------------------------------------------------------------
    History:    
        02-Apr-2012 - Richard Enojas (Salesforce) - Created
        14-Sept-2012 - Joel Jayoma (Cloud Sherpas)- added TP#311
        22-Jul-2013  - N.Patterson  - TT11222 - disable the submit button when they click to ensure no multiple clicking occurs
        26-Sep-2013  - N.Patterson  - TT11595 - Fixed the step 1 / step 2 / Complete banner below the Moving or Selling heading
        10-Oct-2013  - N.Patterson  - TT10401 - Show the accountlist section
    -->
   
    <head>
        <apex:includeScript value="{!$Page.GoogleAnalyticsTracker}" />
        <!-- jquery -->
        <apex:includeScript value="{!URLFOR($Resource.jqueryui1818, '/js/jquery-1.7.1.min.js')}" />
        <apex:stylesheet value="{!$Resource.PortalSidebar_Styles}"/>

        <apex:stylesheet value="{!$Resource.MoveInOut_Styles}" />
        <apex:includeScript value="{!URLFOR($Resource.jqueryui1818, '/js/jquery-ui-1.8.18.custom.min.js')}"/>
        <apex:includeScript value="{!$Resource.experianqas__PopupHelperJS}"/>           
        <apex:stylesheet value="{!URLFOR($Resource.jqueryui1818, '/css/custom-theme/jquery-ui-1.8.18.custom.css')}"/>
        
    </head>
    
    <apex:form id="theForm">
         <apex:actionFunction name="Address" action="{!FullAddress}" status="QASloading" oncomplete="CloseQASDialog();" rerender="newAdd">  
            <apex:param name="firstParam" assignTo="{!Street}" value="" />  
            <apex:param name="secondParam" assignTo="{!City}" value="" />  
            <apex:param name="thirdParam" assignTo="{!State}" value="" />  
            <apex:param name="fourthParam" assignTo="{!PostalCode}" value="" />  
            <apex:param name="fifthParam" assignTo="{!Country}" value="" />  
        </apex:actionFunction> 
       
        <script type="text/javascript">
          // <!--TP311 Start -->  
                                                  
              $(document).ready(function(){ 
              
                  hideManual();      
                  hideSearch();
                  
                    $('[id="thePage:theForm:pageblock:nextbtn"]').click(function(){
                        //var property=$('[id="thePage:theForm:pageblock:pbAcclist:propertylist"]').val();  
                        var property=$('Select option:selected').val(); 
                        //alert(property);
                        
                    });
    
             }); 
             
            
             
                                                
                          
                //Show the QaS dialog         
              function ShowQASDialog() {
                 
                 var option1=$('[id="thePage:theForm:pageblock:pbmoreOptions:pbmoreRadio:1"]').is(':checked');
                 var option0=$('[id="thePage:theForm:pageblock:pbmoreOptions:pbmoreRadio:0"]').is(':checked');
                 //var property=$('[id="thePage:theForm:pageblock:pbAcclist:propertylist"]').text();    
                 //alert(property);
                  
                 //alert(option0);
                 if(option0){
                     try {
                         $(function () {
                              $('#qas-popup').dialog({
                                   dialogClass: 'ui-dropshadow',                    
                                        height: 500,
                                        width: 450,
                                        modal: true,
                                        resizable: false,
                                        zIndex: 60,
                                        title: 'Address Entry'
                                  });
                                  
                              });   
                         
                         $("#qas-popup").dialog("open");    
                         
                          var error = $('h4').text();                   
                         if(error!='' || error!=null){
                           $('[id="thePage:theForm:cmpCall:theComponent:cmpMsg"]').hide();
                           
                         }
                                         
                         showSearch();
                         hideManual();                                  
                         
                        
                         
                     } catch (e) { alert(e.toString()); }
                 } 
                 
                 else{
                     // document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaStreetItem:street').required=false;
                     $('[id="thePage:theForm:testBlock:qaSearchSection:qaStreetItem:street"]').name;
                    //$('.requiredInput ').attr('class','');
                    
                 }
              }                
           
              //Close the QaS dialog
             function CloseQASDialog() {
                try {                   
                    $("#qas-popup").dialog("close");            
                } catch (e) { alert(e.toString()); }
                return false;
             }   
              
              //Show the QaS search component            
              function showSearch() {
                 try {
                     //tovalidateDate();
                     $("#qaSearch").show();
                 } catch (e) { alert(e.toString()); }
              }
              
              //Hide the QaS search component
              function hideSearch() {
                 try {
                     $("#qaSearch").hide();
                 } catch (e) { alert(e.toString()); }
              }
              
              //Hide the manual QaS search div
              function hideManual() {
                 try {
                     $("#qaManual").hide();
                 } catch (e) { alert(e.toString()); }
              }
              
              //Show the manual QaS search div
              function showManual(x) {
                 try {
                       mode = x;
                     $("#qaManual").show(); 
                     clearEntries(x);
                     hideSearch();
                 } catch (e) { alert(e.toString()); }
              }  
              
              function tovalidateDate(){
                CheckDate();
              }
              
           
              function clearEntries(x){
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaStreetItem:street').focus(); 
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaStreetItem:street').value='';
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaStreet2Item:street2').value='';    
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaSuburbItem:suburb').value='';               
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaStateItem:state').value='';
                document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaPostal:postalCode').value='';
               
                 
                if(x == 'manual'){                  
                    document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaCountry:country').value='AUSTRALIA';
                    document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaCountry:country').readOnly=true; 
                    document.getElementById('requiredInputDiv').className="requiredInput";
                    document.getElementById('requiredBlockDiv').className="requiredBlock"; 
                    document.getElementById('requiredInputDivState').className="requiredInput";
                    document.getElementById('requiredBlockDivState').className="requiredBlock"; 
                    document.getElementById('requiredInputDivPostal').className="requiredInput";
                    document.getElementById('requiredBlockDivPostal').className="requiredBlock"; 
                }else{
                
                    document.getElementById('requiredInputDiv').className="";
                    document.getElementById('requiredBlockDiv').className=""; 
                    document.getElementById('requiredInputDivState').className="";
                    document.getElementById('requiredBlockDivState').className=""; 
                    document.getElementById('requiredInputDivPostal').className="";
                    document.getElementById('requiredBlockDivPostal').className=""; 
                    document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaCountry:country').value='';
                    document.getElementById('thePage:theForm:testBlock:qaSearchSection:qaCountry:country').readOnly=false; 
                }               
            }
            
            //Function that parses the address from QAS then display it on their respective component for local and overseas
            function ReceiveAddressManually(){                  
                var mStreet =  $('[id="thePage:theForm:testBlock:qaSearchSection:qaStreetItem:street"]').val();                          
                var mStreet2 =  $('[id="thePage:theForm:testBlock:qaSearchSection:qaStreet2Item:street2"]').val();   
                var mSuburb =  $('[id="thePage:theForm:testBlock:qaSearchSection:qaSuburbItem:suburb"]').val();               
                var mState =  $('[id="thePage:theForm:testBlock:qaSearchSection:qaStateItem:state"]').val();
                var mPostal = $('[id="thePage:theForm:testBlock:qaSearchSection:qaPostal:postalCode"]').val();
                var mCountry =  $('[id="thePage:theForm:testBlock:qaSearchSection:qaCountry:country"]').val();
               
                var mFullStreet, mStatePostal;        
                
                                   
                if(mode == 'manual'){
                    if ((trim(mStreet) == '') || (trim(mSuburb) == '') || (trim(mPostal) == '') || (trim(mCountry) == '') || (trim(mState) == '')) {
                        alert('You must enter a value on all the required fields.');
                        return false;               
                    } 
                       
                }else{
                    if ((trim(mStreet) == '') || (trim(mCountry) == '')) {
                        alert('You must enter a value on all the required fields.');
                        return false;               
                    } 
                }
                
                if (trim(mStreet2) != ''){
                    mFullStreet = mStreet + ', ' + mStreet2 ;                     
                } 
                else{
                    mFullStreet = mStreet;                           
                }
                if (trim(mState) == ''){
                    mStatePostal = mPostal ; 
                }    
                else{    
                    mStatePostal = mState + ', ' + mPostal;          
                }
               
                if(mode == 'manual'){
                    if(mFullStreet.length < 4 || mFullStreet.length > 60){
                        alert('Street address cannot be less than 4 or greater than 60 characters.');
                        return false;
                    }else if(mState.length < 2){
                        alert('State should be 2 or more characters.');
                        return false;
                    }else if(mSuburb.length < 2){
                        alert('Suburb should be 2 or more characters.');
                        return false;
                    }     
                }        
                                
              
             
                   // Get The Full Address                    
                
                Address(mFullStreet,mSuburb,mState,mPostal,mCountry); 
                 
                       
        
                
            }              
                       
            
            //Function that parses the address from QAS then display it on their respective component.
            function ReceiveAddress(address) { 
                    
                var Street = address.AddressLines[0].Line;
                var Street2 = address.AddressLines[1].Line;            
                var Suburb = address.AddressLines[2].Line;
                var State = address.AddressLines[3].Line;
                var Postal = address.AddressLines[4].Line;
                var Country = address.AddressLines[5].Line;
                var completeAddress,fullStreet,StatePostal;                                    
                for (var i=0; i < address.Length; i++) {
                    var line = address.AddressLines[i].Line;
                    
                    if (line != null & line != "") {
                        if (completeAddress == null)
                            completeAddress = line;
                        else                    
                            completeAddress = completeAddress + ', ' + line;
                    }
                }
                if(Street2 != ''){
                    fullStreet = Street +', '+Street2;
                } 
                else{
                    fullStreet = Street;                           
                }
                
                if (trim(State) == ''){
                    StatePostal = Postal ; 
                }    
                else{    
                    StatePostal = State + ', ' + Postal;          
                }
               
                // Get The Full Address 
                Address(fullStreet,Suburb,State,Postal,Country);                
                
           // <!--TP311 End -->                                 
            }            
            
            //Function that forces the cursor to focus on the QAS button when the QAS entry is required error is displayed. 
            window.onload = function focusOnQASbutton(){
                
                //var text = document.getElementById('thePage:theForm:pageblock:j_id150:j_id154:qasAddress');
                //var span_textnode = text.firstChild;
                //var span_text = span_textnode.data;
                //alert(span_text);

                var text = document.getElementById('{!$Component.thePage:theForm:pageblock:j_id150:j_id154:qasAddress}').innerHTML;
               
                if(text == '' || text == null){
                    
                    //Blink effect for the QAS button
                    document.getElementById("forwardbtn").style.backgroundColor="#2E64FE";
                    setTimeout("document.getElementById('forwardbtn').style.backgroundColor=''", 500);
                    setTimeout("focusOnQASbutton()",1500);
                    
                }
            }
                                  
        </script>
        
          <!--TP311 Start -->
                <div id="qas-popup" style="display:none;">
            
                        
                    <div id="qaSearch">
                            <c:QaSPopupPulse id="cmpCall"/>                    
                    </div> 
                        
                    <!--QAS Manual Entry -->
                    <div id="qaManual" class="pbTransparent requiredInput">   
                        <apex:pageBlock id="testBlock">                                                          
                            Please enter your address details below.<br/><br/>                                                   
                            <apex:pageBlockSection id="qaSearchSection" columns="1" >
                                <apex:pageBlockSectionItem id="qaStreetItem">                                                                               
                                <apex:outputLabel value="Street address 1"/> 
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="requiredBlock"></div>
                                            <apex:inputTextarea rows="2" id="street" required="false" styleClass="requiredInput" style="width:250px" >
                                            	
                                            </apex:inputTextarea>
                                        </div>
                                    </apex:outputPanel>                                   
                                </apex:pageBlockSectionItem>
                                            
                                <apex:pageBlockSectionItem id="qaStreet2Item">
                                    <apex:outputLabel value="Street address 2"/> 
                                    <apex:inputTextArea rows="2" label="Street" id="street2" required="false" styleClass="requiredInput" style="width:250px"  /> 
                                </apex:pageBlockSectionItem>
                                
                                <apex:pageBlockSectionItem id="qaSuburbItem">
                                    <apex:outputLabel value="Suburb"/>
                                    <apex:outputPanel id="suburbPanel">
                                        <div class="requiredInput" id="requiredInputDiv">
                                            <div class="requiredBlock" id="requiredBlockDiv"></div>                               
                                                <apex:inputText id="suburb" required="false" style="width:250px" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>
                                         
                                <apex:pageBlockSectionItem id="qaStateItem">
                                    <apex:outputLabel value="State"/> 
                                    <apex:outputPanel >
                                        <div class="requiredInput" id="requiredInputDivState">
                                            <div class="requiredBlock" id="requiredBlockDivState"></div>                                     
                                            <apex:inputText id="state" required="false" style="width:250px" /> 
                                        </div>
                                    </apex:outputPanel>                                  
                                </apex:pageBlockSectionItem>
                                            
                                <apex:pageBlockSectionItem id="qaPostal">
                                    <apex:outputLabel value="Postal code"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput" id="requiredInputDivPostal">
                                            <div class="requiredBlock" id="requiredBlockDivPostal"></div>
                                            <apex:inputText id="postalCode" required="false" style="width:250px"/>
                                        </div>
                                    </apex:outputPanel>  
                                </apex:pageBlockSectionItem>
                                            
                                <apex:pageBlockSectionItem id="qaCountry">
                                    <apex:outputLabel value="Country"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="requiredBlock"></div>
                                            <apex:inputText id="country" required="false" style="width:250px" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>
                                <br/>
                            
                                <apex:pageBlockSectionItem id="qaButtons">
                                    <apex:outputLabel value=""/>
                                    <apex:pageBlockSectionItem dataStyle="horizontal-align: middle">                      
                                        <apex:commandButton id="acceptSearchButton" onclick="ReceiveAddressManually();"  value="Accept" styleClass="btnPrimary" />
                                        <apex:commandButton onclick="CloseQASDialog();" value="Cancel"  immediate="true" styleclass="btnBlueText" /> 
                                    </apex:pageBlockSectionItem>                                        
                                </apex:pageBlockSectionItem>                                                                     
                            </apex:pageBlockSection>                              
                        </apex:pageBlock>                                             
                    </div>
                </div>    
               
                <apex:actionStatus id="loadingStat">
                    <apex:facet name="start">
                        <c:EnhancedActionStatus BackColor="#ffffff"
                                               borderColor="#6B6B6B"
                                               borderSize="1"
                                               height="50px"
                                               width="120px"
                                               margintop="-25px"
                                               marginleft="-60px"
                                               ImageUrl="{!$Resource.AjaxAnimation}"
                                               Message="Loading..."/>
                    </apex:facet>
                </apex:actionStatus>
                    
                    
                <!--TP311 END -->
                                  
                <apex:outputPanel id="sidebarContainer" layout="block" styleClass="sideBarCellDiv" >
                	<apex:outputPanel id="accountsListAndSidebar" layout="block" styleClass="pbTransparent" >
	                	<c:PortalAccountsList displayAccountList="false"/> <!-- TT10401-show the accountlist section -->
	                    <!--  sidebar -->                           
	                    <div style="margin-top:-65px;"><!-- TT10401-shift up 65 px to remove gap -->
		                    <c:PortalSidebar id="sidebar" groupName="Accounts" currentAccRecordType="{!customer.RecordType.DeveloperName}" 
		                                    currentDevName="Accounts_MovingSelling" /> <!-- TT10401-Don't show Accounts title anymore -->
						</div>
					</apex:outputPanel>
                </apex:outputPanel>
        
                <div class="contentCellDiv">
                    <!-- Page Block Header -->

            
                    <div class="pageBlockHeader">

                        <apex:outputPanel layout="block" styleclass="pageBlockTitle">
                            Moving or Selling
                        </apex:outputPanel>
                    </div>
            
                    <apex:pageBlock id="pageblock">
                       
                        <!-- TT11595 - Given we don't know how many steps, just display one step
                        <div class="moveinoutstep1Image" id="wizardDiv">
                            <apex:panelGrid cellspacing="0" cellpadding="0" styleClass="stepInnerGrid">
                                <span class="activeStep stepFirst">Step 1</span>
                                <span class="stepIncomplete2">Step 2</span>                      
                                <span class="stepIncomplete">Complete</span>
                            </apex:panelGrid>
                        </div> -->
                        <div class="moveinoutstep1Image" id="wizardDiv">
                            <apex:panelGrid cellspacing="0" cellpadding="0" styleClass="stepInnerGrid">
                                <span class="activeStep stepFirst">Step 1</span>
                            </apex:panelGrid>
                        </div>
                    
                        <!--  PAGE MESSAGES -->
                        <div style="margin-top: 5px" id="divError">    
                            <apex:pageMessages id="msg" />
                        </div>

                         
                        <div class="innerContentLHSDiv" Id="divInnerContent">           
                        
                            <apex:outputPanel layout="block" styleClass="" id="pnlBlock">
                                <div class="cellText">
                                    <p>If youâ€™re moving or selling, complete the details below so we can read the property 
                                meter and help make your transition as smooth as possible.</p>
                                      
                                </div>
                            </apex:outputPanel>   
                            <apex:pageBlockSection id="iNFO" 
                            Title="" 
                            columns="1" collapsible="false" />    
                        

                        
                                <apex:outputPanel id="moreOptions">
                                    <apex:actionRegion id="moreOptionsRegion">
                                        <apex:pageBlockSection collapsible="false" columns="1" Id="pbmoreOptions">
                                            <apex:selectRadio value="{!caserec.Type_of_Read__c}" label="I am moving:" required="true" Id="pbmoreRadio">
                                                <apex:selectOption itemValue="Move In" itemLabel="in" id="mIn"/>
                                                <apex:selectOption itemValue="Move Out" itemLabel="out" id="mOut"/>
                                                <apex:actionSupport event="onclick" 
                                                                    rerender="moreOptions "
                                                                    status="loading"/>
                                            </apex:selectRadio>

                                        </apex:pageBlockSection>   
                                    </apex:actionRegion>
                                           
                                    <apex:actionRegion >
                                        
                                        <apex:pageBlockSection collapsible="false" columns="1">
                                
                                            <!-- If 'in' selected -->
                                            <apex:selectRadio value="{!tenantOrOwner}" label="I am moving in as:" 
                                                              required="true" 
                                                              rendered="{!caserec.Type_of_Read__c == 'Move In'}"
                                                              id="movein">
                                                <apex:selectOption itemValue="Tenant" itemLabel="a tenant"/>
                                                <apex:selectOption itemValue="Owner" itemLabel="the owner"/>
                                                <apex:actionSupport event="onclick" 
                                                                    rerender="moreOptions"
                                                                    status="loading"/>
                                            </apex:selectRadio>
                                    
                                            <!-- If 'out' selected -->
                                            <apex:selectRadio value="{!tenantOrOwner}" label="I am:" 
                                                              required="true" 
                                                              rendered="{!caserec.Type_of_Read__c == 'Move Out'}"
                                                              id="moveout">
                                                <apex:selectOption itemValue="Owner" itemLabel="the owner"/>
                                                <apex:selectOption itemValue="Tenant" itemLabel="a tenant"/>
                                                <apex:actionSupport event="onclick" 
                                                                    rerender="moreOptions"
                                                                    status="loading"/>
                                            </apex:selectRadio>   
                                        </apex:pageBlockSection>
                                    </apex:actionRegion>
                             
                                    <apex:actionRegion >
                                        <apex:pageBlockSection collapsible="false" columns="1">  
                                            <!--If 'in' && 'Owner' selected -->
                                            <apex:selectRadio value="{!newOrExistingOwner}" label="I am:" 
                                                              required="true" 
                                                              rendered="{!caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner'}">
                                                <apex:selectOption itemValue="New" itemLabel="the new owner"/>
                                                <apex:selectOption itemValue="Existing" itemLabel="the existing owner"/>
                                                <apex:actionSupport event="onclick" 
                                                                    rerender="moreOptions, buttonsSection"
                                                                    status="loading"/>
                                            </apex:selectRadio>
                            
                                            <!--If 'out' && 'Owner' selected -->
                                            <!--<apex:selectRadio value="{!sellingOrVacating}" label="I am:" 
                                                              required="true" 
                                                              rendered="{!caserec.Type_of_Read__c == 'Move Out' && tenantOrOwner == 'Owner'}">
                                                <apex:selectOption itemValue="Selling" itemLabel="selling the property"/>
                                                <apex:selectOption itemValue="Vacating" itemLabel="vacating the property"/>
                                                <apex:actionSupport event="onclick" 
                                                                    rerender="moreOptions"
                                                                    status="loading"/>
                                            </apex:selectRadio>-->
                                    
                                            <apex:inputcheckbox value="{!isSelling}" label="Are you selling the property?"
                                                        rendered="{!caserec.Type_of_Read__c == 'Move Out' && tenantOrOwner == 'Owner'}">
                                            <apex:actionSupport event="onclick" 
                                                            rerender="moreOptions"
                                                            status="loading"/>
                                            </apex:inputcheckbox>
                                        </apex:pageBlockSection>
                                    </apex:actionRegion>
                        
                                    <!--If 'in' && 'Owner' && 'New' selected 
                                    or
                                    If 'out' && 'Owner' && 'isSelling' selected
                                    -->
                                    
                                    <!--
                                    <apex:outputpanel id="btns">                        
                                        <div style="margin-top:50px; margin-bottom:10px; text:-align:center;font-weight:bold;"><apex:outputText value="New Address: {!forwardpAddress}" rendered="{!showNextBtn}" /></div> 
                                    </apex:outputpanel>
                                    -->
                                    <!-- #Added new button for QAS -->
                                    <apex:outputPanel id="newAdd"  rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'New')
                                                                     ||(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Tenant')}">
                                        <apex:pageBlockSection columns="2" >
                                            <apex:pageBlocksectionItem dataStyle="width:55px;">
                                                <apex:outputLabel style="margin-left:-10px;margin-top:15px;width:150px;font-weight:bold;">I am moving to:</apex:outputLabel>    
                                             </apex:pageBlocksectionItem>
                                              <apex:pageBlocksectionItem dataStyle="width:100px;">
                                                <apex:outputText id="qasAddress" value="{!pAddress}" ></apex:outputText>
                                            </apex:pageblockSectionitem>
                                                
                                        </apex:pageBlockSection>                                    
                                                <div style="text-align:center!important;">
                                                    <input type="button" value="{!if(pAddress=='','Enter address','Edit address')}" 
                                                        id="forwardbtn"
                                                        class="btnGreen"
                                                        onclick="ShowQASDialog();" />                                                 
                                                                                                                 
                                                </div>                                
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'Existing')
                                                                     ||(caserec.Type_of_Read__c == 'Move Out' && tenantOrOwner == 'Owner')
                                                                     ||(tenantOrOwner == 'Tenant')}">
                                        <div style="position:relative; top:20px;">
                                             <c:PortalRequiredField styleclass="requiredFieldIndicatorRHSNoHeight"/>
                                         </div> 
                                    </apex:outputPanel>
                                   
                                    <!--OCT 30. 2012 MOVE THIS LINE-->
                                     <apex:actionRegion Id="pbAccRegion">
                                        <apex:outputPanel id="accountList">
                                            <!--if 'out' --> 
                                        <apex:actionRegion >
                                            <apex:outputPanel id="accountListOut">
                                                <apex:pageBlockSection id="blkAccountList" collapsible="false" title="I am moving out of:" columns="1" 
                                                                rendered="{!caserec.Type_of_Read__c == 'Move Out'}">
                                                <apex:selectList value="{!caseRec.Billing_Account__c}"
                                                            style="width:260px"
                                                            size="1" label="Property address" id="propertylist" required="true">
                                                    <apex:selectOptions value="{!activeBillAcctOptions}" />
                                                    <apex:actionSupport event="onchange" action="{!PopulateBillingAccount}" reRender="accountListOut" status="loading"/>
                                                </apex:selectList>
                                            </apex:pageBlockSection>
                                        </apex:outputPanel>
                                       </apex:actionRegion>
                                            <apex:pageBlockSection id="pbAcclist" collapsible="false" title="I am moving to:" columns="1" 
                                                                rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'Existing')}">
                                                <apex:selectList value="{!caseRec.Billing_Account__c}"
                                                            style="width:260px"
                                                            size="1" label="Select property" id="propertylist" >
                                                    <apex:selectOptions value="{!activeBillAcctOptions}" id="SOptions"/>
                                                    <apex:actionSupport event="onchange" action="{!PopulateBillingAccount}" reRender="accountList" status="loading" id="Support"/>
                                                </apex:selectList>
                                                
                                                <apex:pageblockSectionItem >
                                                     <apex:outputLabel >Date</apex:outputLabel>
                                                                                        
                                                     <apex:outputPanel >                                            
                                                     <div class="requiredInput">
                                                        <div class="requiredBlock"></div>
                                                            <apex:inputField value="{!caserec.Move_In_Out_Date__c}" label="Date" id="movingtodate"  />
                                                            <script type="text/javascript">                       
                                                                // hide the date defaulter
                                                                var movingtodate= document.getElementById("{!$Component.movingtodate}");
                                                                movingtodate.nextSibling.style.display="none";
                                                                document.getElementById('{!$Component.movingtodate}').size = "8";
                                                                
                                                            </script>
                                                    </div>
                                                    </apex:outputPanel>
                                                </apex:pageblockSectionItem>
                                                
                                                    <apex:outputLabel >If property is not listed, send us an
                                                    <apex:outputLink title="test"  value="{!$Page.PortalEnquiries}" 
                                                            style="font-weight: bold;"> enquiries.</apex:outputLink>
                                                    </apex:outputLabel>
                                                
                                            </apex:pageBlockSection>
                                        </apex:outputPanel>
                                    </apex:actionRegion>
                        
                                     
                                    <apex:pageBlockSection collapsible="false" title="Settlement is on:" columns="1" 
                                                           rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'New')
                                                                     ||(caserec.Type_of_Read__c == 'Move Out' && tenantOrOwner == 'Owner' && isSelling)}">
                                        <apex:pageblockSectionItem >
                                            <apex:outputLabel >Date</apex:outputLabel>
                                                                                
                                        <apex:outputPanel >                                            
                                            <div class="requiredInput">
                                                <div class="requiredBlock"></div>
                                                <apex:inputField value="{!caserec.Move_In_Out_Date__c}" label="Date" id="settlementdate"  />
                                                <script type="text/javascript">
                                                    // hide the date defaulter
                                                    settlementdate = document.getElementById("{!$Component.settlementdate}");
                                                    settlementdate.nextSibling.style.display="none";
                                                    document.getElementById('{!$Component.settlementdate}').size = "8";                               
                                                </script>
                                            </div>
                                        </apex:outputPanel>                                                                                
                                        </apex:pageblockSectionItem>
                                        
                                    </apex:pageBlockSection>
                        
                                    <!--If 'in' && 'Owner' && 'Existing' selected 
                                        or
                                        if 'in' && 'tenant' selected
                                        or
                                        If 'out' && 'Owner' selected && 'isSelling' not selected
                                        or 
                                        If 'out' && 'tenant' selected)
                                    
                                    -->
                                    <apex:pageBlockSection collapsible="false" title="I am moving on:" columns="1" 
                                                           rendered="{!(caserec.Type_of_Read__c == 'Move Out' && tenantOrOwner == 'Owner' && NOT(isSelling))
                                                                     ||(tenantOrOwner == 'Tenant')}">
                                        <!--<apex:inputField value="{!caserec.Move_In_Out_Date__c}" label="Date" id="moveinoutdate" required="true" onchange="ShowQASDialog();"/>-->
                                        <apex:pageblockSectionItem >
                                            <apex:outputLabel >Date</apex:outputLabel>
                                            <apex:outputPanel >
                                                <div class="requiredInput">
                                                    <div class="requiredBlock"></div>
                                                    <apex:inputField value="{!caserec.Move_In_Out_Date__c}" label="Date" id="moveinoutdate"/>
                                                    <script type="text/javascript">                       
                                                        // hide the date defaulter
                                                        var moveinoutdate = document.getElementById("{!$Component.moveinoutdate}");
                                                        moveinoutdate.nextSibling.style.display="none";
                                                        document.getElementById('{!$Component.moveinoutdate}').size = "8";                              
                                                            
                                                    </script>
                                                </div>
                                            </apex:outputPanel>
                                        </apex:pageblockSectionItem>
                                    </apex:pageBlockSection>
				                    <apex:actionRegion >
                        				<apex:pageBlockSection title="" collapsible="false" columns="1" rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'New')}">
                                    		<apex:selectRadio value="{!numberOption}" label="Contact Number:">
                                				<apex:selectOption itemValue="mobile" itemLabel="Mobile" />
                                				<apex:selectOption itemValue="work" itemLabel="Work" />
                                				<apex:selectOption itemValue="other" itemLabel="Other" />
                            				</apex:selectRadio>
                             				<apex:pageBlockSectionItem > 
                              					<apex:outputLabel value=""/>
                             					<apex:outputPanel >
                            						<div class="requiredInput">
                            							<div class="requiredBlock"></div>
                               							<apex:inputText style="position:relative;width:200px;" title="Mandatory Field" alt="Mandatory Field" id="contactNumber" value="{!contactNumber}" />
                           							</div>
                           						</apex:outputPanel>
                           					</apex:pageBlockSectionItem>
                           				</apex:pageBlockSection>
                           			</apex:actionRegion>
                        
                      
                        
                                    <!--If 'in' && 'Owner' && 'New' selected
                                        or
                                        If 'in' && 'Tenant'
                                     -->
                                    <!-- <apex:pageBlockSection collapsible="false" title="I am moving to:" columns="1" 
                                                           rendered="{!(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'New')
                                                                     ||(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Tenant')}">
                                        <apex:inputField value="{!caserec.Portal_Move_In_Street_Address__c}" label="Street address" id="streetaddress" required="true"/>     
                                        <apex:inputField value="{!caserec.Portal_Move_In_City__c}" label="Suburb" id="city" required="true"/>    
                                        <apex:inputField value="{!caserec.Portal_Move_In_Postal_Code__c}" label="Postcode" id="postcode" required="true" />
                                        </apex:pageBlockSection>
                                     -->                      
                          
                        
                                    <!--If 'in' && 'Owner' && 'Existing' selected -->
                                   
                                    
                                </apex:outputPanel>
                     
                                <div style="clear:both"/><br/>

                                <div style="margin:0 auto;text-align:center!important;">
                             		<apex:outputPanel id="buttonsSection">
	                                	<apex:commandButton value="Submit" 
				                            id="submitbtn"
				                            styleClass="btnPrimary" 
				                            action="{!NextStep}" 
				                            status="loading" 
				                            rendered="{!NOT(submitted) && (caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'New')}">
				                            <script>
				                                submitBtn = document.getElementById('{!$Component.submitBtn}');
				                                BuildTermsDialog();
				                            </script>
				                        </apex:commandButton>
	                                    <apex:commandButton value="Next" 
	                                        id="nextbtn"
	                                        styleClass="btnPrimary" 
	                                        action="{!NextStep}"                      
	                                        status="loading"
	                                        rendered="{!NOT(caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner') || (caserec.Type_of_Read__c == 'Move In' && tenantOrOwner == 'Owner' && newOrExistingOwner == 'Existing')}"/>
	                                    <apex:commandButton value="Cancel" 
	                                        id="cancelbtn"
	                                        styleClass="btnClearGreenText"
	                                        action="{!home}" 
	                                        immediate="true" 
	                                        rendered="{!NOT(submitted)}"/>
                                    </apex:outputPanel>
                                </div>
                        
                        </div>
                        <div class="innerContentRHSDiv">
                            <!--  live chat -->
                            <c:LiveChat />

                            <c:PortalKnowledgeSidebar rowClass="borderDottedMedGreyBottom "
                                divClass="pbTransparent pbMedGreyDottedHeader pbNoPad grey"
                                divStyle="width: 205px"/>

                            <!--  quick links -->
                            <div style="position: relative;"><c:PortalQuickLinks mode="Property"/></div>
                        </div>
                    
                        <div style="clear:both"/>
                    </apex:pageBlock>
            
            
                </div>
                <apex:actionStatus id="QASloading">
                    <apex:facet name="start">
                        <c:EnhancedActionStatus BackColor="#ffffff"
                                               borderColor="#6B6B6B"
                                               borderSize="1"
                                               height="50px"
                                               width="120px"
                                               margintop="-25px"
                                               marginleft="-60px"
                                               ImageUrl="{!$Resource.AjaxAnimation}"  
                                               Message="Loading..."/>
                    </apex:facet>
                </apex:actionStatus>
                <apex:actionStatus id="loading">
                    <apex:facet name="start">
                        <c:EnhancedActionStatus BackColor="#ffffff"
                                               borderColor="#6B6B6B"
                                               borderSize="1"
                                               height="50px"
                                               width="120px"
                                               margintop="-25px"
                                               marginleft="-60px"
                                               ImageUrl="{!$Resource.AjaxAnimation}"  
                                               Message="Loading..."/>
                    </apex:facet>
                </apex:actionStatus>
    </apex:form> 

</apex:page>